(function(e,t,n){if(typeof t!="function"){return console.error("nette.ajax.js: jQuery is missing, load it please")}var r=function(){var e={self:this,initialized:false,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var r=true;var i=Array.prototype.slice.call(arguments);var s=i.shift();var o=typeof s=="string"?s:s.name;var u=typeof s=="object"?s.off||{}:{};i.push(e.self);t.each(e.on[o],function(s,o){if(o===n||t.inArray(s,u)!==-1)return true;var a=o.apply(e.contexts[s],i);return r=a===n||a});return r},requestHandler:function(t){if(!e.self.ajax({},this,t))return},ext:function(r,i,s){while(!s){s="ext_"+Math.random();if(e.contexts[s]){s=n}}t.each(r,function(t,n){e.on[t][s]=n});e.contexts[s]=t.extend(i?i:{},{name:function(){return s},ext:function(t,n){var r=e.contexts[t];if(!r&&n)throw"Extension '"+this.name()+"' depends on disabled extension '"+t+"'.";return r}})}};this.ext=function(r,i,s){if(typeof r=="object"){e.ext(r,i)}else if(i===n){return e.contexts[r]}else if(!i){t.each(["init","load","prepare","before","start","success","complete","error"],function(t,i){e.on[i][r]=n});e.contexts[r]=n}else if(typeof r=="string"&&e.contexts[r]!==n){throw"Cannot override already registered nette-ajax extension '"+r+"'."}else{e.ext(i,s,r)}return this};this.init=function(t,r){if(e.initialized)throw"Cannot initialize nette-ajax twice.";if(typeof t=="function"){this.ext("init",null);this.ext("init",{load:t},r)}else if(typeof t=="object"){this.ext("init",null);this.ext("init",t,r)}else if(t!==n){throw"Argument of init() can be function or function-hash only."}e.initialized=true;e.fire("init");this.load();return this};this.load=function(){e.fire("load",e.requestHandler);return this};this.ajax=function(r,i,s){if(!r.nette&&i&&s){var o=t(i),u,a;var f=r.nette={e:s,ui:i,el:o,isForm:o.is("form"),isSubmit:o.is("input[type=submit]")||o.is("button[type=submit]"),isImage:o.is("input[type=image]"),form:null};if(f.isSubmit||f.isImage){f.form=f.el.closest("form")}else if(f.isForm){f.form=f.el}if(!r.url){r.url=f.form?f.form.attr("action"):i.href}if(!r.type){r.type=f.form?f.form.attr("method"):"get"}if(o.is("[data-ajax-off]")){r.off=o.data("ajaxOff");if(typeof r.off=="string")r.off=[r.off]}}e.fire({name:"prepare",off:r.off||{}},r);if(r.prepare){r.prepare(r)}a=r.beforeSend;r.beforeSend=function(t,r){if(a){var i=a(t,r);if(i!==n&&!i)return i}return e.fire({name:"before",off:r.off||{}},t,r)};u=t.ajax(r);if(u&&(typeof u.statusText==="undefined"||u.statusText!=="canceled")){u.done(function(t,n,i){e.fire({name:"success",off:r.off||{}},t,n,i)}).fail(function(t,n,i){e.fire({name:"error",off:r.off||{}},t,n,i)}).always(function(t,n){e.fire({name:"complete",off:r.off||{}},t,n)});e.fire({name:"start",off:r.off||{}},u,r);if(r.start){r.start(u,r)}}return u}};t.nette=new(t.extend(r,t.nette?t.nette:{}));t.fn.netteAjax=function(e,n){return t.nette.ajax(n||{},this[0],e)};t.fn.netteAjaxOff=function(){return this.off(".nette")};t.nette.ext("validation",{before:function(e,r){if(!r.nette)return true;else var i=r.nette;var s=i.e;var o=t.extend({keys:true,url:true,form:true},r.validate||function(){if(!i.el.is("[data-ajax-validate]"))return;var e=i.el.data("ajaxValidate");if(e===false)return{keys:false,url:false,form:false};else if(typeof e=="object")return e}()||{});var u=false;if(i.el.attr("data-ajax-pass")!==n){u=i.el.data("ajaxPass");u=typeof u=="bool"?u:true}if(o.keys){var a=s.button||s.ctrlKey||s.shiftKey||s.altKey||s.metaKey;if(i.form){if(a&&i.isSubmit){this.explicitNoAjax=true;return false}else if(i.isForm&&this.explicitNoAjax){this.explicitNoAjax=false;return false}}else if(a)return false}if(o.form&&i.form&&!((i.isSubmit||i.isImage)&&i.el.attr("formnovalidate")!==n)){if(i.form.get(0).onsubmit&&i.form.get(0).onsubmit()===false){s.stopImmediatePropagation();s.preventDefault();return false}}if(o.url){if(/:|^#/.test(i.form?r.url:i.el.attr("href")))return false}if(!u){s.stopPropagation();s.preventDefault()}return true}},{explicitNoAjax:false});t.nette.ext("forms",{init:function(){var t;if(!e.Nette||!(t=this.ext("snippets")))return;t.after(function(t){t.find("form").each(function(){e.Nette.initForm(this)})})},prepare:function(e){var n=e.nette;if(!n||!n.form)return;var r=n.e;var i=e.data||{};var s={};if(n.isSubmit){s[n.el.attr("name")]=n.el.val()||""}else if(n.isImage){var o=n.el.offset();var u=n.el.attr("name");var a=[Math.max(0,r.pageX-o.left),Math.max(0,r.pageY-o.top)];if(u.indexOf("[",0)!==-1){s[u]=a}else{s[u+".x"]=a[0];s[u+".y"]=a[1]}}if(typeof i!="string"){i=t.param(i)}s=t.param(s);e.data=n.form.serialize()+(s?"&"+s:"")+"&"+i}});t.nette.ext("snippets",{success:function(e){var n=[];if(e.snippets){for(var r in e.snippets){var i=this.getElement(r);t.each(this.beforeQueue,function(e,t){if(typeof t=="function"){t(i)}});this.updateSnippet(i,e.snippets[r]);t.each(this.afterQueue,function(e,t){if(typeof t=="function"){t(i)}})}}this.before(n)}},{beforeQueue:[],afterQueue:[],before:function(e){this.beforeQueue.push(e)},after:function(e){this.afterQueue.push(e)},updateSnippet:function(e,t,n){if(typeof e=="string"){e=this.getElement(e)}if(e.is("title")){document.title=t}else{this.applySnippet(e,t,n)}},getElement:function(e){return t("#"+this.escapeSelector(e))},applySnippet:function(e,t,n){if(!n&&e.is("[data-ajax-append]")){e.append(t)}else{e.html(t)}},escapeSelector:function(e){return e.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,"\\$&")}});t.nette.ext("redirect",{success:function(t){if(t.redirect){e.location.href=t.redirect;return false}}});t.nette.ext("state",{success:function(e){if(e.state){this.state=e.state}}},{state:null});t.nette.ext("unique",{start:function(e){if(this.xhr){this.xhr.abort()}this.xhr=e},complete:function(){this.xhr=null}},{xhr:null});t.nette.ext("abort",{init:function(){t("body").keydown(t.proxy(function(e){if(this.xhr&&e.keyCode==27&&!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){this.xhr.abort()}},this))},start:function(e){this.xhr=e},complete:function(){this.xhr=null}},{xhr:null});t.nette.ext("load",{success:function(){t.nette.load()}});t.nette.ext("init",{load:function(e){t(this.linkSelector).off("click.nette",e).on("click.nette",e);t(this.formSelector).off("submit.nette",e).on("submit.nette",e).off("click.nette",":image",e).on("click.nette",":image",e).off("click.nette",":submit",e).on("click.nette",":submit",e);t(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,e).on("click.nette",this.buttonSelector,e)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})})(window,window.jQuery)